数仓开发流程：
1、数据、需求调研：需求了解沟通，业务调研，需求分析，确定数据源
2、明确数据域：根据业务需求进行主题域的划分，每条业务线所有的核心业务拆解出来，拆解成一个个不可拆分的事件行为，比如。。。。，罗列出来后开始划分主题域，把相同，相似，有联系的业务过程归纳总结出来，
归到不同的主题域下面。
3、构建总线矩阵：做完主题域和业务过程的归纳总结之后，做了一个总线矩阵设计，把每个主题域下的业务过程抽象出维度，每个业务过程分别和哪些维度相关联，做了一个映射匹配，比如 **业务过程是和**ID，
**场景等等维度有关
4、维度模型设计：建设完主题域，业务过程和总线矩阵之后，开始维度建模的一个设计，包括维度建模的分层，首先是ODS层，这一层不会做任何的数据处理，原始数据是什么样的，ODS层的数据就是什么样的，
起到一个原始数据备份的作用，这一层主要分成了三个方面进行数据的接入，包括: 1.日志行为，2.业务库的业务数据，3.行外外部数据。然后是明细DWD层，这一层我们的设计原则是尽量以最细粒度去设计，
比如用户的每一条行为日志最为一行数据，尽量把维度最细粒度化，比如用户以天或者以小时为单位的日志行为，都放到明细表里。汇总层DWS的话，一般是把主题域下所有业务过程相关的指标都汇总到一张表里，
让维度也尽量最细粒度，这样后续用起来也会更加灵活一些，ADS层，是比较个性化的层，一般是与报表做关联，没有公共共享的能力
5、上线部署优化：设计完主题域，业务过程，维度分层以后，敲定下来需要建设哪些表以后，会做一个物理模型的开发，也就是ETL开发，这一侧包括需要去相应的平台注册表Schema，维度schema等，然后平台做ETL的开发，
之后就是例行调度任务部署上线，以及后续的验证维护优化。



划分主题域过程：
1、梳理业务过程，理解业务需求
2、把业务过程，包括用户的一些日志行为，以最细粒度的拆分出来，拆解成一个个不可拆分的事件行为
3、最后会与业务同事一起，把相同相似或者有联系的事件归纳在一起，然后归结到已命名完成的主题域下


零售集市8大主题域：客户、资产、贷款、产品、营销、交易、内部管理、外部数据



优化了运行效率低的ETL任务：具体量化（优化了多少的任务，提升了多少的效率，减少了多少的存储空间），如何去优化（技术层面、模型层面）
1、模型层面: 有的数据使用的是底层的ODS表，或者DWD明细表，但此时是已经有了轻度汇总表DWS，所以会使用DWS表进行对他们的替换，数据量就会得到大幅度的减少，以达到节约效率的目的
2、代码层面: select * 更换为具体字段，数据持久化，cache 到内存当中
3、参数层面: 调整spark参数，调整executor memory, executor core, driver memory等等
4、小文件处理: 如果没有设置文件输出个数的话，最后的文件会以很多小文件的方式写出，导致后面需要读取该文件处理数据的时候可能会造成IO异常。这时就可以用coalesce或者repartition
                去设置文件最后输出的结果个数


数仓调优：

1、调度优化（生产测试环境分离、任务优先级划分、提前跑、减少层级依赖）

2、模型优化 （模型选择、拆表、合表、中间层建设、合理分区、拉链表）

3、计算优化（减少输入数据、避免数据倾斜）

4、同步优化（合理参数设置）


spark调优：
1、参数调优：
    Executor core, Executor memory

2、高性能算子调优：
    mapPartition
    foreachPartition
    filter后使用coalsesce减少分区数量
    persist / cache 对数据持久化
    reduceByKey和aggrateByKey取代groupByKey
    repartition解决sparksql低并行度的性能问题

3、开发调优：
    广播变量(broadcast) 结合业务说明
    尽量避免复用同一个RDD，如果需要，则进行cache持久化
    尽量避免shuffle类算子(reduceByKey, join, distinct, repartition)
    使用kryo优化序列化性能


交易业务流程：
1、首先我们会跟据用户的一个风险等级，不同的产品在不同的渠道进行展示宣传，比如手机银行APP展示，线下网点客户经理VIP宣传，网点柜面，招呼，短信，988888等等对客户介绍产品的功能点，此时就会记录
    一些类似像渠道的数据
2、然后用户会根据不同的渠道点击外链进入手机银行APP的产品详情页，此时就会生成一些点击记录，这其实就可以分析出一些基础指标，比如客户对于产品的粘度
3、然后就是进入购买流程，此时会自动选卡，判断卡号是否在用户的卡列表，然后选择分仓号，是属于组合分仓还是大湾区分仓，然后判断出交易是否被允许
4、交易被允许后会判断是否购买产品有白名单控制，账户是否为白名单，如果用户为黑名单，则不允许被购买
5、用户可购买的话，产品会需要签署合同或者协议，并且判断用户风评是否有效，是否购买产品为超风险产品
6、进入购买主视图，用户输入金额，输入金额是否高于账户余额，首次购买是否达到购买下限
7、用户提交购买申请，签署电子合同，执行购买，购买成功


缓慢变化维处理方式：
    1、直接覆盖原始值：最简单粗暴，但无法做历史分析
    2、增加属性列：新增一列，用来记录变化。适合变化较少的情况，如果经常变化，增加无限量字段明显不合适
    3、增加维度行：新增一条新纪录，并且用一个专门的字段（时间、版本、是否生效等）进行标识，区分哪个数据是最新的，绝大部分适用


数据分析常用6种方法
1、多维分析:
    需要明确2个方向: 维度和指标
    所谓指标，指的是用来记录关键流程的，衡量目标的单位或方法，如DAU、留存率、转化率等。
    所谓维度，指的是观察指标的角度，如时间、来源渠道、地理位置、产品版本维度等。
    多维分析，就是在多个维度拆解，观察对比维度细分下的指标。实现将一个综合指标细分，从而发现更多问题

2、趋势分析:
    也叫对比分析，最常用的是基于时间的对比分析，主要分为同比，环比，定基比
    环比：与相邻的上一个周期做对比，如本周与上一周，本月与上个月
    同比：俩个个周期同一个时间点的比较，如2022年8月与2021年8月
    定基比：和指定的时间基点对比

3、转化分析（漏斗分析）:
    主要是分析产品流程或关键节点的转化效果，常借助漏斗图展现转化效果。
    漏斗图是一种外形类似漏斗的可视化图表，该方法可以直观追踪产品的整体流程，追踪业务的转化路径，追踪
    不同生命阶段下的用户群体表现
    常用的场景有：
    1）产品流程的关键路径转化追踪，比如电商的购买流程；
    2）业务价值路径的转化流程追踪，如常用的AARRR模型的价值转化追踪；
    3）虚拟流程类指标追踪，如按生命周期区分的不同生命周期阶段的用户流转形态追踪

4、公式拆解法:


5、公式拆解法:


6、结构化分析:






















